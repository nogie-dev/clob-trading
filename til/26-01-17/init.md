# 설명

## 지금까지의 구조

서비스 중인 거래소들을 써보며, “한 가격에 여러 주문을 공정하게 처리해야 한다”는 관점에서 오더북을 설계:

- CEX 오더북의 기본 요소: Bids/Asks, Limit/Market, 가격과 수량.
- 특정 가격에 Bid/Ask를 넣으면, 그 가격 레벨의 주문들과 순차적으로 매칭된다고 보고, 가격 → 주문 큐 구조를 선택.
- 한 호가에 여러 이용자가 몰릴 때 선입선출로 처리하는 게 공정하다고 판단해, 가격 레벨마다 주문서 큐를 두는 설계로
    시작.

## 다음 단계

- 오더북에 쌓인 주문을 Bid/Ask 가격·수량에 맞춰 매칭 처리.
    - 전량 체결 시: 해당 주문을 오더북에서 제거.
    - 부분 체결 시: 처리 방식 선택
        - 잔량 업데이트: 기존 주문의 수량을 체감시켜 남은 잔량을 유지.
        - UTXO식 교체: 기존 주문을 제거하고, 잔량만큼의 새 주문을 큐의 맨 앞에 추가.

- 오더북의 정렬을 어느 시점에 어떻게 처리할 것인가
    - 정렬이 필요한 대상
        - 호가 (Heap) : 항상 최고, 최저 호가에 대한 정렬 상태를 유지해야 함
            - max, min heap 알고리즘
                - 최대값, 최솟값은 즉시 추출 가능하고, 수정 및 삭제에 O(log n) 만큼 소요
        - 주문 순서 (Queue) : 단순 Queue로 주문이 들어온 순서대로 처리
            - 주문 생성 -> push
            - 주문 취소 -> pop

- 거래 체결
    - Limit의 경우 bid, ask가 mapping될 경우 즉시 체결
    - Market의 경우 반대 포지션의 최고 혹은 최저 호가에 즉시 체결
